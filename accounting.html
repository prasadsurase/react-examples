<!DOCTYPE html>
<html>
  <head>
    <meta charset='UTF-8' />
    <title>Accounting</title>
    <script src='build/react.js'></script>
    <script src='build/react-dom.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js'></script>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js'></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" >
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" ></script>
  </head>
  <body>
    <div id='container' style="margin-top:50px;"></div>
    <script type='text/babel'>
      var TransactionsSummary = React.createClass({
        render: function(){
          return(
            <ul className="list-group">
              <li className="list-group-item">
                <span className="badge">{this.props.tCount}</span>
                Count
              </li>
              <li className="list-group-item">
                <span className="badge">{this.props.debits}</span>
                Debits
              </li>
              <li className="list-group-item">
                <span className="badge">{this.props.credits}</span>
                Credits
              </li>
              <li className="list-group-item">
                <span className="badge">{this.props.balance}</span>
                Balance
              </li>
              <li className="list-group-item">
                <span className="badge">{this.props.total}</span>
                Total
              </li>
            </ul>
          );
        }
      });

      var TransactionForm = React.createClass({
        getInitialState: function(){
          return { date: '', reason: '', amount: '' };
        },

        handleChange: function(e){
          switch(e.target.name){
            case 'date':
              this.setState({date: e.target.value});
              break;
            case 'reason':
              this.setState({reason: e.target.value});
              break;
            case 'amount':
              this.setState({amount: e.target.value});
              break;
          }
        },

        handleSubmit: function(e){
          e.preventDefault();
          this.props.handleNewRecord(this.state);
          this.setState(this.getInitialState());
        },

        handleCancel: function(e){
          e.preventDefault();
          this.setState(this.getInitialState());
        },

        render: function(){
          return (
            <form onSubmit={this.handleSubmit} className="form-horizontal">
              <div className="form-group">
                <label for="date" className="col-sm-2 control-label">Date: </label>
                <div className="col-sm-10">
                  <input type='text' name='date' className="form-control" value={this.state.date} onChange={this.handleChange}/>
                </div>
              </div>
              <div className="form-group">
                <label for="reason" className="col-sm-2 control-label">Reason: </label>
                <div className="col-sm-10">
                  <input type='text' name='reason' className="form-control" value={this.state.reason} onChange={this.handleChange}/>
                </div>
              </div>
              <div className="form-group">
                <label for="amount" className="col-sm-2 control-label">Amount: </label>
                <div className="col-sm-10">
                  <input type='integer' name='amount' className="form-control" value={this.state.amount} onChange={this.handleChange}/>
                </div>
              </div>
              <div className="form-group">
                <div className="col-sm-offset-2 col-sm-10">
                  <button className="btn btn-primary" type='submit'>Submit</button>
                  <button className="btn" type='button' onClick={this.handleCancel}>Cancel</button>
                </div>
              </div>
            </form>
          );
        }
      });

      var TransactionRow = React.createClass({
        render: function(){
          return (
            <tr>
              <td>{this.props.record.date}</td>
              <td>{this.props.record.reason}</td>
              <td>{this.props.record.amount}</td>
            </tr>
          );
        }
      });

      var TransactionsTable = React.createClass({
        render: function(){
          var rows = [];
          this.props.records.map(function(record, index){
            rows.push(<TransactionRow key={index} record={record} />);
          }.bind(this));
          return (
            <table className="table table-striped table-hover table-bordered">
              <thead>
                <tr>
                  <th> Date </th>
                  <th> Reason </th>
                  <th> Amount </th>
                </tr>
              </thead>
              <tbody>
                { rows }
              </tbody>
            </table>
          );
        }
      });

      var TransactionsDetails = React.createClass({
        getInitialState: function(){
          return { records: [] };
        },

        addRecord: function(record){
          var records = this.state.records;
          records.push(record);
          this.setState({ records: records });
        },

        transactionCount: function(){
          return this.state.records.length;
        },

        debits: function(){
          var sum = 0;
          var records = this.state.records.filter(function(record){ return record.amount < 0});
          if(records.length > 0){
            sum = records.reduce((function(a, b) {
              return a + parseFloat(b.amount);
            }), 0);
          }
          return -sum;
        },

        credits: function(){
          var sum = 0;
          var records = this.state.records.filter(function(record){ return record.amount >= 0});
          if(records.length > 0){
            sum = records.reduce((function(a, b) {
              return a + parseFloat(b.amount);
            }), 0);
          }
          return sum;
        },

        balance: function(){
          return this.credits() - this.debits();
        },

        totalTransactions: function(){
          return this.credits() + this.debits();
        },

        render: function(){
          return (
            <div className="container">
              <div className='row'>
                <div className="col-md-offset-2 col-md-4">
                  <div className="well">
                    <TransactionsSummary tCount={this.transactionCount()} debits={this.debits()} credits={this.credits()}
                    balance={this.balance()} total={this.totalTransactions()}/>
                  </div>
                </div>
                <div className="col-md-4">
                  <div className="well">
                    <TransactionForm handleNewRecord={this.addRecord}/>
                  </div>
                </div>
              </div>
              <div className='row'>
                <div className="col-md-offset-2 col-md-8">
                  <div className="well">
                    <TransactionsTable records={this.state.records}/>
                  </div>
                </div>
              </div>
            </div>
          );
        }
      });

      ReactDOM.render( <TransactionsDetails />, document.getElementById('container'));
    </script>
  </body>
</html>
